var logPPBData,ppbIpad,ppbPrevuDebug;Array.prototype.ppbPrevuMove=function(a,b){return this.splice(b,0,this.splice(a,1)[0]),this},ppbPrevuDebug=1,ppbIpad={},logPPBData=function(a,b,c){var d,e;"undefined"!=typeof ppbPrevuDebug&&ppbPrevuDebug&&(e={message:a,content:[],cells:[],rows:[]},d=jQuery,d.each(ppbData.widgets,function(a,b){b&&b.info?e.content.push("Content "+a+" in Grid: "+b.info.grid+" Cell: "+b.info.cell+" Text: '"+d(b.text).text().substring(0,16)+"'"):e.content.push("Content "+a+" undefined info")}),d.each(ppbData.grid_cells,function(a,b){e.cells.push("Cell "+a+" in Grid: "+b.grid+" with Weight: "+b.weight)}),d.each(ppbData.grids,function(a,b){b.style?e.rows.push("Row "+a+" original id"+b.id+" Contains: "+b.cells+" cells with BG: "+b.style.background+" "+b.style.background_image):e.rows.push("Row "+a+" original id"+b.id+" Contains: "+b.cells+" cells with Styles undefined")}),e.hasOwnProperty(c)?console.log(e[c]):console.log(e),b&&console.log(b))},jQuery(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return a.each(ppbData.grids,function(a,b){ppbData.grids[a].id=a}),a.each(ppbData.grid_cells,function(a,b){ppbData.grid_cells[a].id=a}),a.fn.prevuBlockInit=function(){a(this).each(function(){var b;b=a(this),b.draggable(q.contentDraggable),b.resizable(q.contentResizable),b.droppable(q.moduleDroppable),b.removeClass("ppb-content-v-center ppb-content-h-center")})},a.fn.prevuRowInit=function(){var b;b=a(this),b.find(".ppb-block").prevuBlockInit(),b.find(".panel-grid-cell-container > .panel-grid-cell").resizable(q.resizableCells),tinymce.init(q.tmce),k.sortable("refresh")},d=a("#pootlepb-content-editor-panel"),m=a("#pootlepb-row-editor-panel"),e=a("#pootlepb-confirm-delete"),f=a("#pootlepb-deleting-item"),b=a("#pootlepb-add-row"),n=a("#pootlepb-set-title"),j=a("#pootlepb-post-settings"),l=a("#ppb-ipad-color-picker"),g=a("#ppb-iconpicker"),k=a("#pootle-page-builder"),i=a("#pootlepb-modules-wrap"),c=a("body"),h=a("#ppb-loading-overlay"),o={dialogClass:"ppb-cool-panel",autoOpen:!1,draggable:!1,resizable:!1,title:"Edit content block",height:a(window).height()-50,width:a(window).width()-50,buttons:{Done:function(){}}},q={noRedirect:!1,debug:!0,unSavedChanges:!1,justClickedEditRow:!1,justClickedEditBlock:!1,syncAjax:function(){return jQuery.post(ppbAjax.url,ppbAjax,function(b){var d;return b.replace(RegExp(" ","g"),"")?(d=a(a.parseHTML(b,document,!0)),"function"==typeof q.ajaxCallback&&(q.ajaxCallback(d,ppbAjax,b),ppbCorrectOnResize(),q.ajaxCallback=null),a("style#pootle-live-editor-styles").html(d.find("style#pootle-live-editor-styles").html()),ppbAjax.publish&&(q.unSavedChanges=!1,q.noRedirect||(window.ppbAjaxDebug?c.append('<div class="ajax-debug">'+b+"</div>"):window.location=b)),void(ppbAjax.publish=0)):void console.log("Error: No response from server at "+ppbAjax.url)})},sync:function(b,d){var e;if(logPPBData("Before sync"),q.ajaxCallback=b,q.unSavedChanges=!0,q.saveTmceBlock(a(".mce-edit-focus")),delete ppbAjax.data,ppbAjax.data=ppbData,d){if(ppbAjax.publish=d,c.trigger("savingPPB"),ppbAjax.title)return e=[{text:d,icons:{primary:"Publish"===d?"ipad-publish":""},click:function(){n.ppbDialog("close"),q.syncAjax()}}],e[d]=function(){},n.parent().attr("data-action",d),n.ppbDialog("open"),void n.ppbDialog("option","buttons",e)}else delete ppbAjax.publish;logPPBData("After sync"),q.syncAjax()},reset:function(b){var c,d;c={},d=[],b||q.resort(),a.each(ppbData.widgets,function(b,e){var f,g,h,i;if(e&&e.info){for(g=a('.ppb-edit-block[data-i_bkp="'+e.info.id+'"]'),f=g.closest(".ppb-block"),h="panel-"+ppbAjax.post+"-"+e.info.grid+"-"+e.info.cell+"-",i=0;i<25;){if(!c.hasOwnProperty(h+i)){c[h+i]=1,h+=i;break}i++}g.data("index",b).attr("data-index",b),f.attr("id",h),ppbData.widgets[b].info.id=b}else d.push(b)}),a.each(d,function(a,b){delete ppbData.widgets[b]}),a.each(ppbData.grids,function(b,d){var e,f,g,h,i;g=a('.ppb-edit-row[data-i_bkp="'+d.id+'"]'),e=g.closest(".ppb-row"),f=e.children(".panel-row-style").children("style"),i=new RegExp(e.attr("id"),"g"),h="pg-"+ppbAjax.post+"-"+b,g.data("index",b).attr("data-index",b),f.html(f.html().replace(i,h)),e.attr("id",h),c[h]=1,ppbData.grids[b].id=b}),a.each(ppbData.grid_cells,function(b,d){var e,f,g,h,i;for(f=void 0,d.hasOwnProperty("old_grid")?(f=d.old_grid,delete d.old_grid):f=d.grid,g="pgc-"+ppbAjax.post+"-",i=g+f+"-",e=void 0,g+=d.grid+"-",h=0;h<25;){if(!c.hasOwnProperty(g+h)){g+=h,c[g]=1;break}h++}i+=h,e=a("#"+i),e.data("newID",g),ppbData.grid_cells[b].id=b}),a(".ppb-live-edit-object").each(function(){var b,c;b=a(this),c=b.data("index"),b.data("i_bkp",c).attr("data-i_bkp",c)}),a(".ppb-col").each(function(){var b,c;b=a(this),c=b.data("newID"),a(this).attr("id",c),b.removeData("newID")})},resort:function(){ppbData.widgets.sort(function(a,b){var c,d,e,f,g,h;return a.info?b.info?(d=parseInt(a.info.grid),c=parseInt(a.info.cell),e=parseInt(a.info.id),g=parseInt(b.info.grid),f=parseInt(b.info.cell),h=parseInt(b.info.id),1e4*d+1e3*c+e-(1e4*g+1e3*f+h)):-1:1}),ppbData.grid_cells.sort(function(a,b){var c,d,e,f;return c=parseInt(a.grid),d=parseInt(a.id),e=parseInt(b.grid),f=parseInt(b.id),100*c+d-(100*e+f)}),q.unSavedChanges=!0},rowBgToggle:function(){var b;b=m.find("[data-style-field=background_toggle]"),a(".bg_section").hide(),a(b.val()).show()},editPanel:function(){var b,c;"undefined"!=typeof ppbData.widgets[window.ppbPanelI]&&(panels.addInputFieldEventHandlers(d),b=ppbData.widgets[window.ppbPanelI],c=JSON.parse(b.info.style),panels.setStylesToFields(d,c),tinyMCE.get("ppbeditor").setContent(b.text),a("html").trigger("pootlepb_admin_editor_panel_done",[d,c]))},savePanel:function(){var b,c;ppbData.widgets[window.ppbPanelI].text=tinyMCE.get("ppbeditor").getContent(),c=JSON.parse(ppbData.widgets[window.ppbPanelI].info.style),c=panels.getStylesFromFields(d,c),ppbData.widgets[window.ppbPanelI].info.style=JSON.stringify(c),b=a(".ppb-block.active"),q.sync(function(c,d){var e,f,g,h,i;h=b.attr("id"),e=c.find("#"+h),i=e.closest(".panel-grid-cell").children("style").html(),f=b.closest(".panel-grid-cell"),e.addClass("pootle-live-editor-new-content-block"),b.replaceWith(e),e=a(".pootle-live-editor-new-content-block"),a("html").trigger("pootlepb_le_content_updated",[e]),e.removeClass("pootle-live-editor-new-content-block").addClass("active").prevuBlockInit(),f.children("style").length?f.children("style").html(i):i&&(g=a("<style>").html(i),f.prepend(g)),tinymce.init(q.tmce)}),d.ppbDialog("close")},editRow:function(){var b,c,d;b=m.find("[data-style-field=background_toggle]"),q.rowBgToggle(),b.on("change",q.rowBgToggle),"undefined"!=typeof ppbData.grids[window.ppbRowI]&&(c=ppbData.grids[window.ppbRowI],d=c.style,m.find("[data-style-field]").each(function(){var b,c;b=a(this),c=b.attr("data-style-field"),"undefined"==typeof d[c]&&(d[c]=""),"checkbox"===b.attr("type")?d[c]&&b.prop("checked",!0):"slider"===b.attr("data-style-field-type")?b.siblings(".ppb-slider").slider("value",d[c]):"color"===b.attr("data-style-field-type")?b.wpColorPicker("color",d[c]):b.val(d[c]),b.change()}))},saveRow:function(){var b,c;b=ppbData.grids[window.ppbRowI],c=ppbData.grids[window.ppbRowI].style,m.find("[data-style-field]").each(function(){var b,d;b=a(this),d=b.attr("data-style-field"),"checkbox"===b.attr("type")?(c[d]="",b.prop("checked")&&(c[d]=1),b.prop("checked",!1)):(c[d]=b.val(),b.val("")),b.change()}),ppbData.grids[window.ppbRowI].style=c,q.sync(function(b,c){var d,e;e="#pg-"+c.post+"-"+window.ppbRowI,d=b.find(e),d.addClass("pootle-live-editor-new-row"),a(e).replaceWith(d),d=a(".pootle-live-editor-new-row"),a("html").trigger("pootlepb_le_content_updated",[d]),d.removeClass("pootle-live-editor-new-cell"),a(e).prevuRowInit()}),m.ppbDialog("close")},addRow:function(c,d){var e,f,g,h,i,j;for(window.ppbRowI=ppbData.grids.length,i=parseInt(a("#ppb-row-add-cols").val()),logPPBData("Adding row"),j={id:window.ppbRowI,cells:i,style:{background:"",background_image:"",background_image_repeat:"",background_image_size:"cover",background_parallax:"",background_toggle:"",bg_color_wrap:"",bg_image_wrap:"",match_col_hi:"",bg_mobile_image:"",bg_overlay_color:"",bg_overlay_opacity:"0.5",bg_video:"",bg_video_wrap:"",bg_wrap_close:"",class:"",col_class:"",col_gutter:"1",full_width:"",hide_row:"",margin_bottom:"0",margin_top:"0",row_height:"0",style:""}},f=void 0,e=void 0,ppbData.grids.push(j),f={grid:window.ppbRowI,weight:1/j.cells},e={text:"string"==typeof d?d:"<h2>Hi there,</h2><p>I am a new content block, go ahead, edit me and make me cool...</p>",info:{class:"Pootle_PB_Content_Block",grid:window.ppbRowI,style:'{"background-color":"","background-transparency":"","text-color":"","border-width":"","border-color":"","padding":"","rounded-corners":"","inline-css":"","class":"","wc_prods-add":"","wc_prods-attribute":"","wc_prods-filter":null,"wc_prods-ids":null,"wc_prods-category":null,"wc_prods-per_page":"","wc_prods-columns":"","wc_prods-orderby":"","wc_prods-order":""}'}},g=0;g<j.cells;)h=ppbData.grid_cells.length,f.id=h,ppbData.grid_cells.push(a.extend(!0,{},f)),h=ppbData.widgets.length,e.info.cell=g,e.info.id=h,ppbData.widgets.push(a.extend(!0,{},e)),g++;logPPBData("Row added"),b.ppbDialog("close"),q.sync(function(b,d,e){var f,g;g=b.find("#pg-"+d.post+"-"+window.ppbRowI),f=g.find(".panel-grid-cell-container > .panel-grid-cell"),f.css("width",(100-i+1)/i+"%"),a(".ppb-block.active, .ppb-row.active").removeClass("active"),g.find(".pootle-live-editor-realtime:eq(0)").parents(".ppb-block, .ppb-row").addClass("active"),a(".pootle-live-editor.add-row").before(g),g=a("#pg-"+d.post+"-"+window.ppbRowI),g.prevuRowInit(),"function"==typeof c&&c(g)})},rowsSortable:{items:"> .panel-grid",handle:".ppb-edit-row .dashicons-before:first",start:function(b,c){a(this).data("draggingRowI",c.item.index())},update:function(b,c){var d,e,f,g,h,i;e=a(this),h=e.data("draggingRowI"),g=c.item.index(),f=-1,d=a(".mce-edit-focus"),q.saveTmceBlock(d),d.removeClass("mce-edit-focus"),g!=h&&(ppbData.grids.ppbPrevuMove(h,g),i=[h,g].sort(function(a,b){return a-b}),g<h&&(f=1),a.each(ppbData.widgets,function(a,b){var c;b&&b.info&&(c=parseInt(b.info.grid),i[0]<=c&&i[1]>=c&&(c==h?ppbData.widgets[a].info.grid=g:ppbData.widgets[a].info.grid=c+f))}),a.each(ppbData.grid_cells,function(a,b){var c;b&&(c=parseInt(b.grid),ppbData.grid_cells[a].old_grid=c,i[0]<=c&&i[1]>=c&&(c==h?ppbData.grid_cells[a].grid=g:ppbData.grid_cells[a].grid=c+f))}),q.resort(),q.sync(function(){q.reset("noSort")}),logPPBData("Moved row "+h+" => "+g))}},resizableCells:{handles:"w",start:function(){q.resizableCells.correctCellData(a(this)),a(this).siblings(".panel-grid-cell").each(function(){q.resizableCells.correctCellData(a(this))})},stop:function(b,c){a(this).parent().removeClass("ppb-cols-resizing")},resize:function(b,c){var d,e,f,g,h,i,j;f=a(this),d=f.parent(),e=f.prev(),j=1,i=c.size.width,g=c.originalSize.width,h=d.innerWidth(),d.addClass("ppb-cols-resizing"),f.css("width",100*f.innerWidth()/h+"%"),e.siblings(".panel-grid-cell").each(function(){j+=a(this).outerWidth()}),j+=parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")),e.css("width",100*(h-j-1)/h+"%"),q.resizableCells.correctCellData(f),q.resizableCells.correctCellData(e),q.unSavedChanges=!0,g<i?.93*d.width()<j&&f.resizable("widget").trigger("mouseup"):.07*d.width()>f.width()&&f.resizable("widget").trigger("mouseup")},correctCellData:function(b){var c,d,e,f;return f=b.outerWidth(),d=b.parent().width()+1,c=a(".panel-grid-cell-container > .panel-grid-cell").not(".ppb-block *").index(b),e=Math.floor(1e4*f/d)/1e4,b.find(".pootle-live-editor.resize-cells").html('<div class="weight">'+Math.round(1e3*e)/10+"%</div>"),ppbData.grid_cells[c].weight=e,e}},contentDraggable:{handle:".ppb-edit-block .dashicons-move",grid:[5,5],start:function(b,c){var d,e,f;e=a(this),d=e.closest(".panel-row-style"),f=d.css("min-height"),f&&d.find(".panel-grid-cell-container, .ppb-col").not(".ppb-block *").css("min-height",f),e.find(".ppb-edit-block .dashicons-before:first").click(),c.position.left=parseInt(e.css("margin-left")),c.position.top=parseInt(e.css("margin-top"))},drag:function(b,c){var d,e,f,g,h,i,j,k;f=a(this),d=f.parent(),e=f.closest(".panel-row-style"),i={t:parseInt(f.css("margin-top")),l:parseInt(f.css("margin-left"))},j=c.position.top+i.t,h=c.position.left+i.l,g=(parseInt(e.css("min-height"))-f.outerHeight())/2,k=(d.width()-parseInt(f.outerWidth()))/2,(j<-25||h<-25)&&f.draggable("widget").trigger("mouseup"),e.removeClass("pootle-guides-x pootle-guides-y"),g>25&&Math.abs(g-j)<25&&(e.addClass("pootle-guides-x"),c.position.top=g-i.t),k>25&&Math.abs(k-h)<25&&(e.addClass("pootle-guides-y"),c.position.left=k-i.l)},stop:function(b,c){var d,e,f,g,h;h=JSON.parse(ppbData.widgets[window.ppbPanelI].info.style),g={},e=a(this),f={h:"ppb-content-h-center",v:"ppb-content-v-center"},d=e.closest(".panel-row-style"),h.class=h.class?h.class:"",d.hasClass("pootle-guides-y")?h.class+=0>h.class.indexOf(f.h)?" "+f.h:"":h.class=h.class.replace(new RegExp("[ ]?"+f.h,"gi"),""),d.hasClass("pootle-guides-x")?h.class+=0>h.class.indexOf(f.v)?" "+f.v:"":h.class=h.class.replace(new RegExp("[ ]?"+f.v,"gi"),""),d.removeClass("pootle-guides-x pootle-guides-y"),h["margin-top"]=Math.max(1,c.position.top+parseInt(e.css("margin-top"))),h["margin-left"]=Math.max(1,c.position.left+parseInt(e.css("margin-left"))),e.css({marginTop:h["margin-top"],top:"",marginLeft:h["margin-left"],left:"",width:"",height:""}),ppbData.widgets[window.ppbPanelI].info.style=JSON.stringify(h)}},contentResizable:{handles:"e, w",start:function(b,c){var d;d=a(this),d.find(".ppb-edit-block .dashicons-before:first").click(),d.css({maxWidth:9999})},stop:function(b,c){var d,e,f;f=JSON.parse(ppbData.widgets[window.ppbPanelI].info.style),e=a(this),d=e.parent(),f.width=Math.round(parseInt(e.width())),f["margin-left"]=Math.max(1,c.position.left+parseInt(e.css("margin-left"))),e.css({maxWidth:f.width,marginLeft:f["margin-left"],left:"",width:""}),ppbData.widgets[window.ppbPanelI].info.style=JSON.stringify(f)},resize:function(b,c){var d,e,f;f=JSON.parse(ppbData.widgets[window.ppbPanelI].info.style),e=a(this),d=e.parent(),e.outerWidth()-7>d.width()&&(e.css("width",""),e.resizable("widget").trigger("mouseup"))}},moduleDraggable:{helper:"clone",start:function(){i.removeClass("toggle")}},insertModule:function(b,c){var d,e,f;f=c.data("tab"),b.find(".dashicons-move").click(),d=b.find(".mce-content-body"),e=tinymce.get(d.attr("id")),e.selection.select(tinyMCE.activeEditor.getBody(),!0),e.selection.collapse(!1),c.data("callback")&&"function"==typeof window.ppbModules[c.data("callback")]&&window.ppbModules[c.data("callback")](b,e,d),f&&(0<f.indexOf("-row-tab")?a(".panel-grid.active").find(".ppb-edit-row .dashicons-admin-appearance").click():b.find(".ppb-edit-block .dashicons-edit").click(),a('a.ppb-tabs-anchors[href="'+f+'"]').click()),h.fadeOut(500)},moduleDroppable:{accept:".ppb-module",activeClass:"ppb-drop-module",hoverClass:"ppb-hover-module",drop:function(b,c){var d,e;d=c.draggable,e=a(this),h.fadeIn(500),e.hasClass("add-row")?(a("#ppb-row-add-cols").val("1"),q.addRow(function(a){setTimeout(function(){q.insertModule(a.find(".ppb-block").last(),d)},106)},"<p>&nbsp;</p>")):q.insertModule(e,d)}},insertImage:function(){return q.insertImageFrame?void q.insertImageFrame.open():(q.insertImageFrame=wp.media({library:{type:"image"},displaySettings:!0,displayUserSettings:!1,title:"Choose Image",button:{text:"Insert in Content Block"},multiple:!1}),q.insertImageFrame.on("attach",function(){a('.setting[data-setting="url"]').before('<label class="setting" data-setting="url"><span class="name">Size</span><input type="text" value="http://wp/ppb/wp-content/uploads/2016/02/p03hbzwm.jpg" readonly=""></label>')}),q.insertImageFrame.on("select",function(){var a,b,c;c=q.insertImageFrame.state().get("selection").first().toJSON(),a='<figure id="attachment_'+c.id+'" class="'+(c.caption?"wp-caption":"")+'"><img class="size-medium wp-image-'+c.id+'" src="'+c.url+'" alt="'+c.alt+'">'+(c.caption?'<figcaption class="wp-caption-text">'+c.caption+"</figcaption>":"")+"</figure>",b=tinymce.get(q.activeEditor.attr("id")),b.selection.select(tinyMCE.activeEditor.getBody(),!0),b.selection.collapse(!1),b.execCommand("mceInsertContent",!1,a)}),void q.insertImageFrame.open())},saveTmceBlock:function(a){var b;a&&a.length&&(b=a.siblings(".pootle-live-editor").data("index"),ppbData.widgets[b]&&(ppbData.widgets[b].text=a.html(),q.unSavedChanges=!0))},postSettings:function(){j.ppbDialog("open")},tmce:a.extend(!0,{},tinyMCEPreInit.mceInit.ppbeditor)},q.showdown=new showdown.Converter,o.open=q.editPanel,o.buttons.Done=q.savePanel,d.ppbTabs().ppbDialog(o),o.title="Edit row",o.open=q.editRow,o.buttons.Done=q.saveRow,m.ppbTabs().ppbDialog(o),panels.addInputFieldEventHandlers(m),o.title="Add row",o.dialogClass=o.open=null,o.buttons.Done=q.addRow,o.height=ppbAjax.ipad?268:232,o.width=340,b.ppbDialog(o),o.title="Are you sure",o.buttons={Yes:function(){"function"==typeof q.deleteCallback&&q.deleteCallback(),delete q.deleteCallback,e.ppbDialog("close")},Cancel:function(){e.ppbDialog("close")}},o.height=ppbAjax.ipad?241:200,o.width=430,e.ppbDialog(o),o.buttons={Done:function(){n.ppbDialog("close"),q.syncAjax()}},o.height=ppbAjax.ipad?232:227,o.width=430,o.title=n.data("title"),o.close=function(){ppbAjax.title=a("#ppble-live-page-title").val()},n.ppbDialog(o),o.height=610,o.width=520,o.title="Insert icon",o.buttons=[{text:"Remove icon",class:"ui-button-link",click:function(){"function"==typeof p.callback&&p.callback({html:"",attr:"",style:"",class:"",size:"",color:""}),g.ppbDialog("close")}},{text:"Insert",click:function(){var a,b,c,d,e,f,h;g.ppbDialog("close"),b=g.clas.val(),c=g.colr.val(),f=g.size.val(),e=g.link.val(),h="font-size:"+f+"px;color:"+c,a='style="'+h+'" class="fa '+b+'"',d="<i "+a+'><span style="display:none">'+b+"</span></i>","function"==typeof p.callback&&p.callback({html:d,attr:a,style:h,class:b,size:f,color:c,link:e})}}],o.close=function(){},g.ppbDialog(o),g.find("#ppb-icon-choose").iconpicker({placement:"inline"}),g.clas=a("#ppb-icon-choose"),g.colr=a("#ppb-icon-color"),g.size=a("#ppb-icon-size"),g.link=a("#ppb-icon-link"),g.prvu=a("#ppb-icon-preview"),q.iconPrevu=function(a){var b,c,d,e,f;c=g.clas.val(),d=g.colr.val(),e=g.size.val(),f="font-size:"+e+"px;color:"+d,b='style="'+f+'" class="fa '+c+'"',g.prvu.html("<i "+b+'><span style="display:none">'+c+"</span></i>")},g.clas.on("iconpickerUpdated",q.iconPrevu),g.colr.wpColorPicker({change:q.iconPrevu}),g.size.change(q.iconPrevu),p=function(a,b){g.ppbDialog("open"),p.callback=a,g.clas.add(g.find(".iconpicker-search")).val(""),g.prvu.html(""),b&&(b.class&&g.clas.val(b.class).change(),b.color&&g.colr.val(b.color).change(),b.size&&g.size.val(parseInt(b.size)).change(),b.link&&g.link.val(b.link).change())},j.length&&(o.height=700,o.height=ppbAjax.ipad?529:502,o.width=610,o.title="Post settings",o.close=function(){ppbAjax.category=j.find(".post-category").val(),ppbAjax.tags=j.find(".post-tags").val()},o.buttons.Done=function(){j.ppbDialog("close"),q.syncAjax()},j.ppbDialog(o)),k.delegate(".pootle-live-editor .dashicons-before","mousedown",function(){a(".pootle-live-editor-realtime.has-focus").blur()}),k.delegate(".ppb-edit-row .dashicons-before","click",function(){window.ppbRowI=a(this).closest(".pootle-live-editor").data("index")}),k.delegate(".ppb-edit-row .dashicons-admin-appearance","click",function(){m.ppbDialog("open")}),k.delegate(".ppb-edit-row .dashicons-admin-page","click",function(){var b,c,d,e,f,g;q.reset(),b=a(this).closest(".pootle-live-editor"),g=b.data("i"),f=a.extend(!0,{},ppbData.grids[g]),e=g+1,d=[],c=[],window.ppbRowI=b.closest(".pootle-live-editor").data("index"),ppbData.grids.splice(g,0,f),a.each(ppbData.widgets,function(b,d){var f,h;d&&d.info&&(c.push(a.extend(!0,{},d)),f=parseInt(d.info.grid),f==g&&(h=a.extend(!0,{},d),h.info.grid=e,c.push(h)))}),ppbData.widgets=a.extend(!0,[],c.sort(function(a,b){return a.info.grid-b.info.grid})),a.each(ppbData.grid_cells,function(b,c){var f,h;c&&(d.push(a.extend(!0,{},c)),f=parseInt(c.grid),f==g&&(h=a.extend(!0,{},c),h.grid=e,d.push(h)))}),ppbData.grid_cells=a.extend(!0,[],d.sort(function(a,b){return a.grid-b.grid})),q.sync(function(a,c){var d,e;e=a.find("#pg-"+c.post+"-"+window.ppbRowI),d=e.find(".panel-grid-cell-container > .panel-grid-cell"),d.css("width",101/d.length-1+"%"),e.prevuRowInit(),b.closest(".panel-grid").after(e)}),q.reset(),logPPBData()}),k.delegate(".ppb-edit-row .dashicons-no","click",function(){var b,c,d,g;d=[],c=[],b=a(this),g=b.closest(".pootle-live-editor").data("index"),q.deleteCallback=function(){ppbData.grids.splice(g,1),a.each(ppbData.widgets,function(a,b){b&&b.info&&(g==b.info.grid?c.push(a):g<b.info.grid&&ppbData.widgets[a].info.grid--)}),a.each(ppbData.grid_cells,function(a,b){var c;b&&(c=parseInt(b.grid),g==c?d.push(a):g<c&&(ppbData.grid_cells[a].old_grid=c,ppbData.grid_cells[a].grid=--c))}),c.sort(function(a,b){return b-a}),d.sort(function(a,b){return b-a}),a.each(c,function(a,b){ppbData.widgets.splice(b,1)}),a.each(d,function(a,b){ppbData.grid_cells.splice(b,1)}),ppbData.grids.filter(function(){return!0}),ppbData.widgets.filter(function(){return!0}),ppbData.grid_cells.filter(function(){return!0}),b.closest(".panel-grid").remove(),q.sync(function(){q.reset()})},f.html("row"),e.ppbDialog("open")}),k.delegate(".ppb-edit-block .dashicons-before","click touchstart",function(){var b;b=a(this),a(".ppb-block.active, .ppb-row.active").removeClass("active"),b.parents(".ppb-block, .ppb-row").addClass("active"),window.ppbPanelI=b.closest(".pootle-live-editor").data("index"),q.activeEditor=a(this).closest(".ppb-block").children(".pootle-live-editor-realtime")}),k.delegate(".ppb-edit-block .dashicons-edit","click",function(){d.ppbDialog("open")}),k.delegate(".ppb-edit-block .dashicons-no","click",function(){var b,c;q.reset(),b=a(this),c=b.closest(".pootle-live-editor").data("index"),q.deleteCallback=function(){ppbData.widgets.splice(c,1),b.closest(".ppb-block").remove(),q.reset()},f.html("content block"),e.ppbDialog("open")}),k.delegate(".ppb-edit-block .pootle-live-editor-addons .pootle-live-editor-addon","click",function(){var b;b=a(this),d.ppbDialog("open"),d.find('a[href="#pootle-'+b.data("id")+'-tab"]').click()}),k.delegate(".ppb-edit-block .dashicons-format-image","click",function(a){a.preventDefault(),q.insertImage()}),k.delegate(".pootle-live-editor.add-row .dashicons-plus","click",function(){var c;if(b.ppbDialog("open"),c=a(".panel-grid:last-child"),c.length)return a("html, body").animate({scrollTop:c.height()+c.offset().top},1e3),!1}),c.on("click touchstart",function(b){var c,d;if(c=a(b.target),!c.closest(".ppb-block").length||c.closest(".ppb-edit-row .dashicons-before, .ppb-edit-block .dashicons-before").length)try{webkit.messageHandlers.heySwift.postMessage("hideTextFormatting"),webkit.messageHandlers.heySwift.postMessage("hideKeyboard")}catch(a){d=a}else try{webkit.messageHandlers.heySwift.postMessage("showTextFormatting")}catch(a){d=a}}),k.delegate(".ppb-edit-row .dashicons-editor-code","click",function(){var b,c;if(q.justClickedEditRow){try{webkit.messageHandlers.heySwift.postMessage("hideKeyboard")}catch(a){c=a}b=a(this),window.ppbRowI=b.closest(".pootle-live-editor").data("index"),m.ppbDialog("open")}else q.justClickedEditRow=!0,setTimeout(function(){q.justClickedEditRow=!1},520)}),k.delegate(".ppb-edit-block .dashicons-move","click",function(){var b;q.justClickedEditBlock?(b=a(this),window.ppbPanelI=b.closest(".pootle-live-editor").data("index"),d.ppbDialog("open")):(q.justClickedEditBlock=!0,setTimeout(function(){q.justClickedEditBlock=!1},520))}),ppbIpad.updatedNotice=a("#ppb-ipad-updated-notice"),ppbIpad.notice=a("#ppb-ipad-notice"),ppbIpad.AddRow=function(){b.ppbDialog("open")},ppbIpad.StyleRow=function(){var b,c;return c=a(".panel-grid.active"),1!==c.length?void alert("Please select a row by touching any of it's content blocks to start editing."):(b=c.children(".pootle-live-editor"),window.ppbRowI=b.data("index"),void m.ppbDialog("open"))},ppbIpad.StyleContent=function(){var b,c;return b=a(".ppb-block.active"),1!==b.length?void alert("Please select a content block to start editing."):(c=b.children(".pootle-live-editor"),window.ppbPanelI=c.data("index"),void d.ppbDialog("open"))},ppbIpad.insertImage=function(){var b;return b=a(".ppb-block.active"),1!==b.length?void alert("Please select a content block to start editing."):(q.activeEditor=b.children(".pootle-live-editor-realtime"),tinymce.execCommand("mceFocus",!1,q.activeEditor.attr("id")),void q.insertImage())},ppbIpad.preview=function(){q.sync(null,"Publish")},ppbIpad.postSettings=function(){q.postSettings()},ppbIpad.AddRow=function(){b.ppbDialog("open")},ppbIpad.Update=function(){var b,c;if(q.ajaxCallback=function(a,b,c){window.location=c+"?ppb-ipad=preview"},q.unSavedChanges=!0,q.saveTmceBlock(a(".mce-edit-focus")),ppbAjax.data=ppbData,ppbAjax.publish="Publish",q.noRedirect=1,ppbAjax.title)return b=[{text:"Save Draft",click:function(){var a;n.ppbDialog("close");try{webkit.messageHandlers.heySwift.postMessage("updatedLoadingPreview")}catch(b){a=b,console.log("The native context does not exist yet")}ppbIpad.notice.show(0),ppbAjax.publish="Save Draft",q.syncAjax()}},{text:"Publish",icons:{primary:"ipad-publish"},click:function(){var a;n.ppbDialog("close");try{webkit.messageHandlers.heySwift.postMessage("updatedLoadingPreview")}catch(b){a=b,console.log("The native context does not exist yet")}ppbIpad.notice.show(0),ppbAjax.publish="Publish",q.syncAjax()}}],n.parent().data("action","Publish"),n.ppbDialog("option","buttons",b),void n.ppbDialog("open");try{webkit.messageHandlers.heySwift.postMessage("updatedLoadingPreview")}catch(a){c=a,console.log("The native context does not exist yet")}ppbIpad.notice.show(0),q.syncAjax()},l.delegate(".ppb-ipad-color-picker span","mousedown",function(a){return a.preventDefault(),!1}),l.delegate(".ppb-ipad-color-picker span","click",function(b){b.preventDefault(),tinymce.activeEditor.execCommand("ForeColor",!1,a(this).data("color")),l.hide()}),ppbIpad.format={H1:function(){tinymce.activeEditor.execCommand("mceToggleFormat",!1,"h1")},H2:function(){tinymce.activeEditor.execCommand("mceToggleFormat",!1,"h2")},H3:function(){tinymce.activeEditor.execCommand("mceToggleFormat",!1,"h3")},H4:function(){tinymce.activeEditor.execCommand("mceToggleFormat",!1,"h4")},Quote:function(){tinymce.activeEditor.execCommand("mceBlockQuote")},Color:function(){var b;b=Math.max(a(window).scrollTop(),a(".ppb-block.active").offset().top),l.show().css("top",b)},Link:function(){tinymce.activeEditor.execCommand("PPB_Link")},Bold:function(){tinymce.activeEditor.execCommand("Bold")},Italic:function(){tinymce.activeEditor.execCommand("Italic")},Left:function(){tinymce.activeEditor.execCommand("JustifyLeft")},Center:function(){tinymce.activeEditor.execCommand("JustifyCenter")},Right:function(){tinymce.activeEditor.execCommand("JustifyRight")}},k.delegate(".pootle-live-editor.add-content .dashicons-plus","click",function(){var b,c,d;b=a(this),d=b.closest(".panel-grid-cell").attr("id"),c=d.split("-"),b.closest(".panel-grid-cell").addClass("this-cell-is-waiting"),ppbData.widgets.push({text:"<h2>Hi there,</h2><p>I am a new content block, go ahead, edit me and make me cool...</p>",info:{class:"Pootle_PB_Content_Block",grid:c[2],cell:c[3],style:'{"background-color":"","background-transparency":"","text-color":"","border-width":"","border-color":"","padding":"","rounded-corners":"","inline-css":"","class":"","wc_prods-add":"","wc_prods-attribute":"","wc_prods-filter":null,"wc_prods-ids":null,"wc_prods-category":null,"wc_prods-per_page":"","wc_prods-columns":"","wc_prods-orderby":"","wc_prods-order":""}'}}),q.reset(),ppbAjax.customData=d,q.sync(function(b,c){var d;d=b.find("#"+ppbAjax.customData),d.addClass("pootle-live-editor-new-cell"),a(".this-cell-is-waiting").replaceWith(d),d=a(".pootle-live-editor-new-cell"),a("html").trigger("pootlepb_le_content_updated",[d]),d.removeClass("pootle-live-editor-new-cell"),ppbAjax.customData=void 0}),q.reset()}),q.tmce.selector=".pootle-live-editor-realtime:not(.mce-content-body)",q.tmce.verify_html=!1,q.tmce.inline=!0,q.tmce.theme="ppbprevu",q.tmce.fontsize_formats="20px 25px 30px 35px 40px 50px 70px 100px",ppbAjax.ipad?(q.tmce.plugins=q.tmce.plugins.replace("wpeditimage,","").replace("wplink,","ppblink,"),a("a").click(function(a){a.preventDefault()})):(q.tmce.toolbar=["h1","h2","h3","h4","shrameeFonts","fontsizeselect","blockquote","forecolor","ppblink","bold","italic","alignleft","aligncenter","alignright","ppbInsertImage"],j.find("select").chosen()),q.tmce.content_css="http://wp/ppb/wp-includes/css/dashicons.min.css?ver=4.4.2-alpha-36412",q.tmce.setup=function(b){b.onDblClick.add(function(b,c){var d,e;e=a(c.target),e.hasClass("fa")&&(d=e.parent("a"),p(function(b){b.class?(e.attr({class:"fa "+b.class,style:b.style}),b.link?(d.length||(e.wrap("<a></a>"),d=e.parent("a")),d.attr("href",b.link)):e.parent("a").length&&e.unwrap()):e.closest("div.ppb-fa-icon").remove(),q.saveTmceBlock(a(e.closest(".mce-content-body")))},{class:e.attr("class").replace("fa ",""),color:e.css("color"),size:e.css("font-size"),link:d.attr("href")}))}),b.on("change",function(b){q.saveTmceBlock(a(b.target.targetElm))}),b.on("focus",function(b){var c;c=a(b.target.targetElm),a(".ppb-block.active, .ppb-row.active").removeClass("active"),c.parents(".ppb-block, .ppb-row").addClass("active")}),b.addButton("ppbInsertImage",{text:"",icon:"dashicons dashicons-format-image",onclick:function(){ppbIpad.insertImage()}}),b.addButton("ppbAlign",function(){var b;return b=[{icon:"alignleft",tooltip:"Align left",value:"alignleft"},{icon:"aligncenter",tooltip:"Align center",value:"aligncenter"},{icon:"alignright",tooltip:"Align right",value:"alignright"}],{type:"listbox",text:"",icon:"alignleft",minWidth:70,onclick:function(){},onselect:function(a){var b,c;b=tinymce.activeEditor,c=this.value().replace("align",""),b.execCommand("Justify"+c[0].toUpperCase()+c.substring(1))},values:b,onPostRender:function(){var c,d;c=tinymce.activeEditor,d=this,c.on("nodeChange",function(e){var f,g;f=c.formatter,g=null,a.each(e.parents,function(c,e){a.each(b,function(a,b){if(f.matchNode(e,b.value))return d.value(b.value),d.settings.icon=b.icon,!1})})})}}}),b.addButton("shrameeFonts",function(){var b;return b=[{text:"Default",value:"inherit"},{text:"Georgia",value:"Georgia, serif"},{text:"Arial Black",value:'"Arial Black", Gadget, sans-serif'},{text:"Comic Sans MS",value:'"Comic Sans MS", cursive, sans-serif'},{text:"Impact",value:"Impact, Charcoal, sans-serif"},{text:"Courier New",value:'"Courier New", Courier, monospace'},{text:"Abril Fatface",value:"Abril Fatface"},{text:"Amatic SC",value:"Amatic SC"},{text:"Dancing Script",value:"Dancing Script"},{text:"Droid Serif",value:"Droid Serif"},{text:"Great Vibes",value:"Great Vibes"},{text:"Inconsolata",value:"Inconsolata"},{text:"Indie Flower",value:"Indie Flower"},{text:"Lato",value:"Lato"},{text:"Lobster",value:"Lobster"},{text:"Lora",value:"Lora"},{text:"Oswald",value:"Oswald"},{text:"Pacifico",value:"Pacifico"},{text:"Passion One",value:"Passion One"},{text:"Patua One",value:"Patua One"},{text:"Playfair Display",value:"Playfair Display"},{text:"Poiret One",value:"Poiret One"},{text:"Raleway",value:"Raleway"},{text:"Roboto",value:"Roboto"},{text:"Roboto Condensed",value:"Roboto Condensed"},{text:"Roboto Mono",value:"Roboto Mono"},{text:"Roboto Slab",value:"Roboto Slab"},{text:"Shadows Into Light",value:"Shadows Into Light"},{text:"Sigmar One",value:"Sigmar One"},{text:"Source Sans Pro",value:"Source Sans Pro"},{text:"Ubuntu Mono",value:"Ubuntu Mono"}],{type:"listbox",text:"Font",icon:!1,minWidth:70,classes:"shramee-fonts-control",onclick:function(){},onselect:function(a){var b,d;b=tinymce.activeEditor,d=this.value(),d||b.formatter.remove("shrameeFontFormat"),-1===d.indexOf(",")?(b.formatter.apply("shrameeFontFormat",{font:d,gfont:d.replace(" ","+")}),c.append('<link href="https://fonts.googleapis.com/css?family='+d.replace(" ","+")+'"  rel="stylesheet">')):b.formatter.apply("shrameeFontFormat",{
font:d})},values:b,onPostRender:function(){var c,d;c=tinymce.activeEditor,d=this,c.on("nodeChange",function(c){var e;e=null,a(c.parents).each(function(){var c;if(c=a(this).css("font-family"),a.each(b,function(b,d){if(-1<c.indexOf(d.text))return e=d.value,a(".mce-shramee-fonts-control").find(".mce-txt").html(d.text),!1}),e)return!1}),e||(a(".mce-shramee-fonts-control").find(".mce-txt").html("Font"),e="inherit"),d.state.set("value",e)})}}}),b.addButton("ppbFontStyles",function(){var b,c;return b=[{text:"Elegant shadow",value:"ppbfost-elegant-shadow"},{text:"Deep shadow",value:"ppbfost-deep-shadow"},{text:"Inset shadow",value:"ppbfost-inset-shadow"},{text:"Retro shadow",value:"ppbfost-retro-shadow"}],c="",{type:"listbox",text:"Font Style",icon:!1,minWidth:70,classes:"ppbFoStField",onselect:function(c){var d,e;d=tinymce.activeEditor,e=this.value(),a.each(b,function(a,b){d.formatter.remove("ppbFoStFormat",{value:b.value})}),d.formatter.apply("ppbFoStFormat",{value:e})},values:b,onPostRender:function(){var d,e;d=tinymce.activeEditor,e=this,d.on("nodeChange",function(d){var f;f=null,a(d.parents).each(function(){var c;if(c=a(this),a.each(b,function(b,d){if(c.hasClass(d.value))return f=d.value,a(".mce-ppbFoStField").find(".mce-txt").html(d.text),!1}),f)return!1}),f||(a(".mce-ppbFoStField").find(".mce-txt").html("Font Style"),f="inherit"),c=f,e.state.set("value",f)})}}})},q.tmce.formats={shrameeFontFormat:{inline:"span",classes:"ppb-google-font",attributes:{"data-font":"%gfont"},styles:{fontFamily:"%font"}},ppbFoStFormat:{block:"h2",classes:"%value"}},tinymce.init(q.tmce),k.sortable(q.rowsSortable),k.find(".panel-grid").each(function(){a(this).prevuRowInit()}),a('[href="#ppb-live-update-changes"]').click(function(){q.sync(null,"Save Draft")}),a('[href="#ppb-live-post-settings"]').click(function(){j.ppbDialog("option","buttons",{Done:function(){j.ppbDialog("close"),q.sync("Publish")}}).ppbDialog("open")}),a('[href="#ppb-live-publish-changes"]').click(function(){q.sync(null,"Publish")}),a(".ppb-edit-block").click(function(){var b;b=a(this).siblings(".mce-content-body").attr("id"),tinymce.get(b).focus()}),a("#ppble-feat-img-prevu").click(function(){var b;return event.preventDefault(),"undefined"!=typeof b?void b.open():(b=wp.media.frames.ppbFeaturedImageFrame=wp.media({title:"Featured Image",button:{text:"Set Featured Image"},multiple:!1}),b.on("select",function(){var c;c=b.state().get("selection").first().toJSON(),ppbAjax.thumbnail=c.id,a("#ppble-feat-img-prevu").css("background-image","url("+c.sizes.thumbnail.url+")")}),void b.open())}),window.onbeforeunload=function(a){if(q.unSavedChanges)return"You have unsaved changes! Click 'Update' in admin bar to save.\n\nYour changes will be lost if you dan't save."},q.resort(),q.reset("noSort"),i.find(".ppb-module").draggable(q.moduleDraggable),k.find(".ppb-block, .ppb-live-add-object.add-row").droppable(q.moduleDroppable),window.ppbModules.image=function(a,b){q.insertImage()},window.ppbModules.chooseIconDialog=function(b,c,d){p(function(b){var e;c.selection.setCursorLocation(c.getBody().firstChild,0),c.selection.collapse(!1),e="div",b.link&&(b.html='<a href="'+b.link+'">'+b.html+"</a>"),a("#ppb-icon-inline").prop("checked")&&(e="span"),d.prepend("<"+e+' class="ppb-fa-icon" style="text-align: center;">&nbsp;&nbsp;'+b.html+"&nbsp;&nbsp;</div>"),q.saveTmceBlock(d)})},window.ppbModules.unsplash=function(a,b){ShrameeUnsplashImage(function(a){var c;c='<img src="'+a+'">',b.selection.select(tinyMCE.activeEditor.getBody(),!0),b.selection.collapse(!1),b.execCommand("mceInsertContent",!1,c)})},window.ppbModules.button=function(a,b){b.execCommand("pbtn_add_btn_cmd")},window.ppbModules.heroSection=function(a){var b;return b=a.closest(".panel-grid").find(".ppb-edit-row"),b.find(".ui-sortable-handle").click(),ppbData.grids[ppbRowI].style.full_width=!0,ppbData.grids[ppbRowI].style.background_toggle=".bg_image",ppbData.grids[ppbRowI].style.row_height="500"},window.ppbModules.onePager=function(b){return b.find(".ppb-edit-block .dashicons-edit").click(),a('a.ppb-tabs-anchors[href="#pootle-ppb-1-pager-tab"]').click(),ppbModules.heroSection(b)},c.on("savingPPB",function(){return ppbAjax.data.google_fonts=[],c.find("[data-font]").not('[data-font="%gfont"]').each(function(){return ppbAjax.data.google_fonts.push(a(this).attr("data-font"))})}),a("html").on("pootlepb_le_content_updated",function(a,b){return ppbSkrollr.refresh(b.find(".ppb-col"))})});